{% extends "base.html" %}

{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'subscribe/css/subscribe.css' %}">
{% endblock %}

{% block header %}
    <div class="header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="container text-center">
        <div class="row pt-4">
            <div class="col text-center mt-3">
                <h2>Are you ready to take your playing to the next level?</h2>

                <hr class="w-75 mb-1">

                <h6 class="py-2 text-uppercase text-secondary">Only Â£4 per month with an annual membership. Free to cancel anytime.</h6>

                <h6 class="text-uppercase text-secondary">Become a member today!</h6>
            </div>
        </div>

        <div class="row">
            <div class="subscription-container col-10 offset-1">
                <div class="row"></div>

                <div class="row my-3">
                    {% for p in products reversed %}
                        <div class="col-6">
                            <div class="card mx-5 shadow" style="border-radius: 10px; border:none; ">
                                <div class="card-body">
                                    <h5 class="card-title font-weight-bold">{{p.name}}</h5>

                                    <p class="card-text text-muted">
                                        {{ p.description|linebreaksbr }}
                                    </p>

                                    {% if p.name == 'Yearly' %}
                                        <p class="small"><strong>SAVE {{ percentage_saved | floatformat:0 }}% When you pay {{ p.name }}!</strong></p>
                                    {% endif %}

                                    {% for plan in p.plan_set.all %}
                                    <h5 >{{ plan.human_readable_price }}</h5>
                                    <div class="text-right">
                                        <input type="checkbox" name="{{p.name}}" value="{{p.id}}" onclick="planSelect('{{p.name}}' ,'{{plan.human_readable_price}}', '{{plan.id}}')">
                                    {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <br><br><hr><br><br>
                <div>
                    <div class="row">
                        <div class="col-12 mb-5">
                            <div class="card mx-5 shadow rounded" style="border-radius:50px;border:none">
                                <div class="card-body">
                                    <h5 class="card-title font-weight-bold">Checkout</h5>
                                    <p class="text-muted ">Enter card details.  Your subscription will start immediately</p>
                                    <div class="row">
                                        <div class="col-6 text-muted">
                                            <p>Plan:</p>
                                            <p>Total:</p>
                                        </div>
                                        <div class="col-6 text-right">
                                            <p id="plan"></p>
                                            <p id="price"></p>
                                            <p hidden id="priceId"></p>
                                        </div>

                                    </div>
                                    <br>
                                    <form id="subscription-form" >
                                        <div id="card-element" class="MyCardElement">
                                            <!-- Elements will create input elements here -->
                                        </div>
                                        
                                        <!-- We'll put the error messages in this element -->
                                        <div class="mb-3 text-danger" id="subscribe-card-errors" role="alert"></div>
                                        <button id="submit" type="submit">
                                            <div class="spinner-border  spinner-border-sm text-light hidden" id="spinner" role="status">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                            <span id="button-text">Subscribe</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block post_js %}
    {{ block.super }}
    {{ stripe_public_key|json_script:"id_stripe_public_key" }}
    {{ client_secret|json_script:"id_client_secret" }}
    <script src="{% static 'subscribe/js/subscribe_stripe_elements.js' %}"></script>
{% endblock %}