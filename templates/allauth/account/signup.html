{% extends "account/base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Signup" %}{% endblock %}

{% block inner_content %}
<hr>
<h2 class="logo-font mb-4">{% trans "Sign Up" %}</h2>
<hr>

<p>{% blocktrans %}Already have an account? Then please <a href="{{ login_url }}">sign in</a>.{% endblocktrans %}</p>

<form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
  {% csrf_token %}
  {{ form|crispy }}
  {% if redirect_field_value %}
  <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
  {% endif %}
  <a class="btn btn-outline-danger rounded-0 text-uppercase" href="{% url 'account_login' %}">Back to Login</a>
  <button type="submit">{% trans "Sign Up" %}</button>
</form>

{% endblock %}

{% block post_js %}
    <script type="text/javascript">
        function createCustomer() {
            let billingEmail = document.querySelector('#email').value;
            return fetch('/create-customer', {
            method: 'post',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: billingEmail,
            }),
            })
            .then((response) => {
                return response.json();
            })
            .then((result) => {
                // result.customer.id is used to map back to the customer object
                // result.setupIntent.client_secret is used to create the payment method
                return result;
            });
        }
    ​
        let signupForm = document.getElementById('signup-form');
    ​
        signupForm.addEventListener('submit', function (evt) {
            evt.preventDefault();
            // Create Stripe customer
            createCustomer().then((result) => {
            customer = result.customer;
            });
        });
    </script>
{% endblock %}